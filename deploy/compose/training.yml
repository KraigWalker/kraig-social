services:
  kraig-training:
    build:
      context: .
      dockerfile: apps/kraig-training/Dockerfile
    networks: [dokploy-network]
    environment:
      - TRAINING_API_BASE_URL=/training/api
    labels:
      - traefik.enable=true
      - traefik.docker.network=dokploy-network
      - traefik.http.routers.kraig-training.rule=Host(`kraig.social`) && PathPrefix(`/training`)
      - traefik.http.routers.kraig-training.priority=100
      - traefik.http.services.kraig-training.loadbalancer.server.port=3000

  kraig-training-admin:
    build:
      context: .
      dockerfile: apps/kraig-training-admin/Dockerfile
    networks: [dokploy-network]
    environment:
      - TRAINING_API_BASE_URL=/training/api
    labels:
      - traefik.enable=true
      - traefik.docker.network=dokploy-network
      - traefik.http.routers.kraig-training-admin.rule=Host(`kraig.social`) && PathPrefix(`/training/admin`)
      - traefik.http.routers.kraig-training-admin.priority=110
      - traefik.http.services.kraig-training-admin.loadbalancer.server.port=3000

  kraig-training-api:
    build:
      context: .
      dockerfile: services/kraig-training-api/Dockerfile
    networks: [dokploy-network]
    environment:
      - NODE_ENV=production
      - PORT=8787
    labels:
      - traefik.enable=true
      - traefik.docker.network=dokploy-network
      - traefik.http.routers.kraig-training-api.rule=Host(`kraig.social`) && PathPrefix(`/training/api`)
      - traefik.http.routers.kraig-training-api.priority=120
      - traefik.http.services.kraig-training-api.loadbalancer.server.port=8787

networks:
  dokploy-network:
    external: true
